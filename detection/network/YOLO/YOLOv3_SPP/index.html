
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="ffx">
      
      
        <link rel="canonical" href="https://ffuxiang.gitee.io/detection/network/YOLO/YOLOv3_SPP/">
      
      
        <link rel="prev" href="../../RetinaNet/">
      
      
        <link rel="next" href="../YOLOv4/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.14">
    
    
      
        <title>YOLOv3-SPP - ffx的个人博客</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#yolov3-spp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="ffx的个人博客" class="md-header__button md-logo" aria-label="ffx的个人博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ffx的个人博客
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              YOLOv3-SPP
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://ffuxiang.gitee.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Ffuxiang
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="ffx的个人博客" class="md-nav__button md-logo" aria-label="ffx的个人博客" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ffx的个人博客
  </label>
  
    <div class="md-nav__source">
      <a href="https://ffuxiang.gitee.io/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Ffuxiang
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resume/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    个人简历
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../fined_domain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    细粒度/域适应笔记
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    目标检测
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            目标检测
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../detection_sum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    目标检测汇总
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    关键概念
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            关键概念
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concept/anchor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    锚点
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concept/regression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    回归参数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../concept/IoU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IoU
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    通用程序
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            通用程序
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_1" >
        
          
          <label class="md-nav__link" for="__nav_4_3_1" id="__nav_4_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数据增强
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_1">
            <span class="md-nav__icon md-icon"></span>
            数据增强
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program/data_augment/affine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    仿射变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program/data_augment/mosaic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mosaic增强
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program/anchor_gen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    锚点生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program/anchor_match/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    锚点匹配
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program/regression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    参数编码解码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program/IoU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计算IoU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program/train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    训练程序
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    检测网络
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            检测网络
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_4_1" id="__nav_4_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Faster R-CNN
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_1">
            <span class="md-nav__icon md-icon"></span>
            Faster R-CNN
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Faster_RCNN/structure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网络结构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Faster_RCNN/RPN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RPN模块
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Faster_RCNN/ROI_Head/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROI Head模块
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../RetinaNet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RetinaNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4_3" id="__nav_4_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    YOLO系列
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4_3">
            <span class="md-nav__icon md-icon"></span>
            YOLO系列
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    YOLOv3-SPP
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    YOLOv3-SPP
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      综述
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      介绍
    </span>
  </a>
  
    <nav class="md-nav" aria-label="介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      细节
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faster_r-cnn" class="md-nav__link">
    <span class="md-ellipsis">
      与Faster R-CNN的差异
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      源码笔记
    </span>
  </a>
  
    <nav class="md-nav" aria-label="源码笔记">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      网络结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      定义所有模块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      定义特征融合操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      定义预测层
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      损失的计算
    </span>
  </a>
  
    <nav class="md-nav" aria-label="损失的计算">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      标签数据的匹配
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../YOLOv4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YOLOv4
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/DETR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DETR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/DeDETR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deformable DETR
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    常用模块
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            常用模块
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../module/FPN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FPN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../module/FL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../module/NL/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    自动驾驶
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            自动驾驶
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    论文笔记
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            论文笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../auto/paper/HADAR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HADAR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../auto/paper/BEVFormer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BEVFormer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/DeDETR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deformable DETR
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../auto/PCV/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    点云可视化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../auto/PCC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    点云与图像映射
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    视觉SLAM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            视觉SLAM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../auto/SLAM/SLAM_ch3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    三维空间刚体运动
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    transformer系列
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            transformer系列
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/transformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/ViT/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ViT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/Swin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Swin Transformer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/DETR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DETR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/DeDETR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deformable DETR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/Maskformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maskformer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/ViT_Adapter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ViT Adapter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/DINO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DINO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../transformer/CLIP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLIP及相关改进工作
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    强化学习
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            强化学习
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../RL/DQN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DQN算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../RL/AC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AC算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../RL/PPO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PPO算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../RL/DDPG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DDPG算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../RL/landing_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    《RL落地指南》笔记
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    图像增强
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            图像增强
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    HDR
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            HDR
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../img_enhance/HDR/HDR-Transformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HDT-Transformer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    扩散模型
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            扩散模型
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../img_enhance/DDPM/DDPM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DDPM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../img_enhance/DDPM/GDP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GDP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数据集
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            数据集
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../img_enhance/dataset/deraining/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    去雨
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../img_enhance/dataset/HDR_dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HDR
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    评测指标
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            评测指标
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../img_enhance/matrix/PSNR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PSNR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../img_enhance/matrix/SSIM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSIM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    其他论文
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            其他论文
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../other_paper/PartialConv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    局部卷积
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../other_paper/attention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    注意力机制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../other_paper/Cycle_GAN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cycle GAN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../other_paper/saliency_sampling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    显著性采样
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../other_paper/GradCAM/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grad-CAM
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PyTorch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            PyTorch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/sum_pytorch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch学习笔记汇总
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2" id="__nav_10_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    nn方法
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2">
            <span class="md-nav__icon md-icon"></span>
            nn方法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2_1" >
        
          
          <label class="md-nav__link" for="__nav_10_2_1" id="__nav_10_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    网络结构
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_1">
            <span class="md-nav__icon md-icon"></span>
            网络结构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/layers/nn.Linear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.Linear
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/layers/nn.Conv2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.Conv2d
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/layers/nn.BatchNorm2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.BatchNorm2d
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/layers/nn.AvgPool2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.AvgPool2d
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/layers/nn.AdaptiveAvgPool2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.AdaptiveAvgPool2d
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/layers/nn.Dropout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.Dropout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/layers/nn.MultiheadAttention/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.MultiheadAttention
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/layers/nn.Embedding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.Embedding
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2_2" id="__nav_10_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    激活函数
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_2">
            <span class="md-nav__icon md-icon"></span>
            激活函数
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/activations/nn.ReLU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.ReLU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/activations/nn.LeakyReLU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.LeakyReLU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/activations/nn.PReLU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.PReLU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/activations/nn.Sigmoid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.Sigmoid
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/activations/nn.Tanh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.Tanh
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/activations/nn.GELU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.GeLU
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2_3" >
        
          
          <label class="md-nav__link" for="__nav_10_2_3" id="__nav_10_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    损失函数
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_3">
            <span class="md-nav__icon md-icon"></span>
            损失函数
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/loss_functions/nn.L1Loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.L1Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/loss_functions/nn.MSELoss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.MSELoss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/loss_functions/nn.CrossEntropyLoss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.CrossEntropyLoss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/loss_functions/nn.KLDivLoss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.KLDivLoss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/loss_functions/nn.MarginRankingLoss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.MarginRankingLoss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/loss_functions/nn.SmoothL1Loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.SmoothL1Loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/loss_functions/nn.TripletMarginLoss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nn.TripletMarginLoss
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_2_4" >
        
          
          <label class="md-nav__link" for="__nav_10_2_4" id="__nav_10_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    nn.functional方法
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_10_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2_4">
            <span class="md-nav__icon md-icon"></span>
            nn.functional方法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/F/F.interpolate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    F.interpolate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/nn/F/F.normalize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    F.normalize
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_3" >
        
          
          <label class="md-nav__link" for="__nav_10_3" id="__nav_10_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    utils.data方法
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_3">
            <span class="md-nav__icon md-icon"></span>
            utils.data方法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/data/data.RandomSampler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data.RandomSampler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/data/data.WeightedRandomSampler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data.WeightedRandomSampler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/data/data.BatchSampler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data.BatchSampler
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_4" >
        
          
          <label class="md-nav__link" for="__nav_10_4" id="__nav_10_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    optim方法
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_4">
            <span class="md-nav__icon md-icon"></span>
            optim方法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/optim/LambdaLR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LambdaLR
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_5" >
        
          
          <label class="md-nav__link" for="__nav_10_5" id="__nav_10_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    torch方法
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_5">
            <span class="md-nav__icon md-icon"></span>
            torch方法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.cat_torch.stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.cat与torch.stack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.chunk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.chunk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.clamp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.clamp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.div/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.div
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.ge_gt_le_lt_ne_eq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.ge_gt_le_lt_ne_eq
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.from_numpy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.from_numpy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.gather/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.gather
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.index_select/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.index_select
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.max/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.max
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.mul/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.mul
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.nonzero/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.nonzero
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.repeat_interleave_tensor.repeat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.repeat_interleave与tensor.repeat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.squeeze_torch.unsqueeze/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.squeeze与torch.unsqueeze
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.transpose_tensor.permute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.transpose与tensor.permute
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/torch/torch.where/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    torch.where
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10_6" >
        
          
          <label class="md-nav__link" for="__nav_10_6" id="__nav_10_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    其他方法
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_6">
            <span class="md-nav__icon md-icon"></span>
            其他方法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/other_method/hook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hook模块
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/other_method/train_eval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    train与eval
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/other_method/cuda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cuda方法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../PyTorch/question/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    常用Python库
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            常用Python库
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/tqdm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tqdm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/rearrange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rearrange
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LaTeX
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            LaTeX
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LaTeX/symbol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    特殊符号
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_1" >
        
          
          <label class="md-nav__link" for="__nav_13_1" id="__nav_13_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux常用指令
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_1">
            <span class="md-nav__icon md-icon"></span>
            Linux常用指令
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/instruct/conda_pip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    conda pip
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/instruct/bypy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bypy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/instruct/screen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    screen命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/instruct/apt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    apt命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/instruct/PID/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    查看进程信息
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_2" >
        
          
          <label class="md-nav__link" for="__nav_13_2" id="__nav_13_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    报错记录
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_13_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_2">
            <span class="md-nav__icon md-icon"></span>
            报错记录
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/error/sum_error/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    汇总
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_2_2" >
        
          
          <label class="md-nav__link" for="__nav_13_2_2" id="__nav_13_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    系统相关
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_2_2">
            <span class="md-nav__icon md-icon"></span>
            系统相关
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/error/linux1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Failed CC version
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13_2_3" >
        
          
          <label class="md-nav__link" for="__nav_13_2_3" id="__nav_13_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NVIDIA
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_13_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13_2_3">
            <span class="md-nav__icon md-icon"></span>
            NVIDIA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/error/nvidia/nvidia1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NVIDIA-SMI has failed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/error/nvidia/nvidia2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NVIDIA kernel module already loaded
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    其他
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            其他
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../other/email/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    邮件模板
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../other/website/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网站汇总
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../other/program/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常用程序
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      综述
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      介绍
    </span>
  </a>
  
    <nav class="md-nav" aria-label="介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      细节
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faster_r-cnn" class="md-nav__link">
    <span class="md-ellipsis">
      与Faster R-CNN的差异
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      源码笔记
    </span>
  </a>
  
    <nav class="md-nav" aria-label="源码笔记">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      网络结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="网络结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      定义所有模块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      定义特征融合操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      定义预测层
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      损失的计算
    </span>
  </a>
  
    <nav class="md-nav" aria-label="损失的计算">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      标签数据的匹配
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="yolov3-spp">YOLOv3-SPP<a class="headerlink" href="#yolov3-spp" title="Permanent link">&para;</a></h1>
<h2 id="_1">综述<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<blockquote>
<p>论文地址：<a href="https://arxiv.org/pdf/1804.02767v1.pdf">https://arxiv.org/pdf/1804.02767v1.pdf</a></p>
<p>源码地址：<a href="https://github.com/ultralytics/yolov3">https://github.com/ultralytics/yolov3</a></p>
<p>类型：一阶段目标检测（one-stage）</p>
</blockquote>
<h2 id="_2">介绍<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>&emsp;&emsp;网络结构如下图所示：</p>
<p><center></p>
<p><img alt="yolov3_spp" src="../img/yolov3_spp.jpg" /></p>
<p></center></p>
<blockquote>
<p>结构图原创，使用请告知</p>
</blockquote>
<p>注：卷积层具体的参数信息请参考：<a href="https://github.com/WZMIAOMIAO/deep-learning-for-image-processing/blob/master/pytorch_object_detection/yolov3_spp/yolov3spp.png">https://github.com/WZMIAOMIAO/deep-learning-for-image-processing/blob/master/pytorch_object_detection/yolov3_spp/yolov3spp.png</a></p>
<h3 id="_3">细节<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>&emsp;&emsp;方便起见，将和前景物体匹配的锚点简称为<strong>前景锚点</strong>，只有前景锚点所对应的置信度分数才不为0。</p>
<p><strong>网络结构</strong></p>
<ul>
<li>
<p>锚点尺寸：在COCO数据集上<strong>利用k-means聚类算法将锚点化为9个簇</strong>，(10,13), (16,30), (33,23), (30,61), (62,45), (59,119), (116,90), (156,198), (373,326)，并且均匀划分到3组预测特征层上；</p>
</li>
<li>
<p>每个锚点要预测<span class="arithmatex"><span class="MathJax_Preview">(1+4+N)</span><script type="math/tex">(1+4+N)</script></span>个数据，分别用于表示前景置信度、四个坐标数据的偏移量、类别预测分数，其中在测试阶段，当前景置信度大于某个阈值时，说明当前锚点上有前景物体，后续启用坐标偏移量计算边界框坐标以及类别预测分数得到物体类别；</p>
</li>
<li>Backbone采用Darknet53网络结构，和ResNet152相比，精度类似但是速度比ResNet152快1倍；</li>
<li>和一般的特征提取网络相比，Darknet53中抛弃了池化操作，采用步长为2的卷积运算实现下采样功能，并且每个残差块中，先用<span class="arithmatex"><span class="MathJax_Preview">1\times1</span><script type="math/tex">1\times1</script></span>的卷积压缩channel，之后再用<span class="arithmatex"><span class="MathJax_Preview">3\times3</span><script type="math/tex">3\times3</script></span>的卷积恢复通道数；</li>
<li>YOLOv3也采用了特征金字塔中自上而下的结构，将浅层特征与深层特征合并，用于预测多个尺度的物体；</li>
<li>SPP模块通过将多个尺度下的池化运算结果相合并，有利于提升网络的感受野；</li>
<li>对于输出的置信度分数，需要先经过一次sigmoid归一化处理（和正常对分类任务的处理方式一样）。</li>
</ul>
<p><strong>训练阶段</strong></p>
<ul>
<li>
<p>训练数据的预处理使用<a href="../../../program/data_augment/mosaic/">mosaic增强</a>和<a href="../../../program/data_augment/affine/">仿射变换</a>；</p>
</li>
<li>
<p>训练损失包括：对于边界框数据的IoU损失（可改为GIoU）、对前景锚点的分类损失以及分类损失（两个分类损失均用交叉熵实现）。</p>
</li>
</ul>
<p><strong>测试阶段</strong></p>
<ul>
<li>batch设为1，并且将原图的宽、高填充至32的整数倍（32为顶层特征图的感受野）；</li>
<li>筛选出前景置信度大于预设阈值的锚点，根据偏移量以及类别分数得到物体边界框坐标以及类别。</li>
</ul>
<h3 id="faster_r-cnn">与Faster R-CNN的差异<a class="headerlink" href="#faster_r-cnn" title="Permanent link">&para;</a></h3>
<p><strong>锚点匹配策略不同</strong></p>
<p>&emsp;&emsp;YOLO会多一个预测值，用于预测前景置信度，因此对于每个物体，YOLO首先匹配出属于哪个网格，计算出中心偏移量，再匹配出属于哪个锚点，得到前景置信度标签，最后再计算边界框宽高。（具体步骤可见《<a href="../../../concept/anchor/">锚点-锚点匹配</a>》）</p>
<p>注：Faster R-CNN中利用整张特征图上的所有锚点预测，因此需要首先构建锚点图，找出所有锚点在原图上对应的坐标数据，之后计算所有锚点和物体边界框之间的IoU，根据IoU对锚点打标签，由于涉及所有锚点的IOU计算，因此运算量较大，相比之下YOLO运算量较小。Faster R-CNN中一个边界框可能会匹配多个特征数据上的锚点（匹配所有可能的锚点，只要IOU足够大即可，不管属于哪个特征点，没有“中心”这一概念）。而YOLO设置了网格点这一概念，每个网格对应一个特征点，整个预测特征图中（对于每层而言），该物体边界框只会匹配一个网格，之后再从这一个网格上找预设锚点，找比较像的，大大降低了锚点匹配数量，降低了运算量，但同时这么操作会减小容错率，从而间接降低检测精度。</p>
<p><strong>边界框回归策略不同</strong></p>
<p>&emsp;&emsp;作者在<a href="https://openaccess.thecvf.com/content_cvpr_2017/papers/Redmon_YOLO9000_Better_Faster_CVPR_2017_paper.pdf">YOLOv2</a>的论文中指出原始的边界框回归策略由于<strong>没有限制偏移量的取值范围</strong>，容易导致中心点<span class="arithmatex"><span class="MathJax_Preview">x,y</span><script type="math/tex">x,y</script></span>可能会预测在图像的任何一点上，相对于当前预测点会产生较大的偏移，进一步导致训练时的不稳定。对此，作者做了改进，<strong>将每个预测特征点视为一个网格</strong>，将<strong>锚点中心的偏移量改为网格左上角坐标的偏移量</strong>，具体如下图所示：</p>
<p><center></p>
<p><img alt="yolov3_spp_1" src="../img/yolov3_spp_1.jpg" /></p>
<p></center></p>
<p>其中<span class="arithmatex"><span class="MathJax_Preview">b_x,b_y,b_w,b_h</span><script type="math/tex">b_x,b_y,b_w,b_h</script></span>表示边界框的四个坐标数据（&rsquo;xywh&rsquo;格式），<span class="arithmatex"><span class="MathJax_Preview">t_x,t_y,t_w,t_h</span><script type="math/tex">t_x,t_y,t_w,t_h</script></span>依次表示四个坐标数据的偏移量，<span class="arithmatex"><span class="MathJax_Preview">c_x,c_y</span><script type="math/tex">c_x,c_y</script></span>表示网格左上角的坐标，<span class="arithmatex"><span class="MathJax_Preview">p_w,p_h</span><script type="math/tex">p_w,p_h</script></span>表示网格上对应锚点的宽高，<span class="arithmatex"><span class="MathJax_Preview">\sigma(\cdot)</span><script type="math/tex">\sigma(\cdot)</script></span>表示<span class="arithmatex"><span class="MathJax_Preview">\text{Sigmoid}</span><script type="math/tex">\text{Sigmoid}</script></span>归一化函数，可以将偏移量限制在<span class="arithmatex"><span class="MathJax_Preview">(0,1)</span><script type="math/tex">(0,1)</script></span>范围内，改进之后<strong>预测框的中心点被限制在锚点中心点所在的网格单元内</strong>，有利于模型的收敛。</p>
<p>注：这里一个特征点对应一个网格，同时一个特征点对应多个锚点，因此一个网格也对应多个锚点。</p>
<h2 id="_4">源码笔记<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>代码参考：</p>
<ul>
<li><a href="https://github.com/WZMIAOMIAO/deep-learning-for-image-processing/tree/master/pytorch_object_detection/yolov3_spp">https://github.com/WZMIAOMIAO/deep-learning-for-image-processing/tree/master/pytorch_object_detection/yolov3_spp</a></li>
<li><a href="https://github.com/ultralytics/yolov3">https://github.com/ultralytics/yolov3</a></li>
</ul>
<p>注：</p>
<ul>
<li>图像预处理策略主要包括<a href="../../../program/data_augment/mosaic/">mosaic增强</a>和<a href="../../../program/data_augment/affine/">仿射变换</a>；</li>
<li>传入的<code>targets</code>中的坐标数据是<strong>相对坐标</strong>，数据从0-1取值，0表示图片左侧、上侧，1表示图片右侧、下侧。因此在<strong>等比放缩图片</strong>时，不用额外处理边界框数据，只需要将相对数据乘以特征图、原图长宽，就可以得到物体在特征图、原图上的坐标；</li>
<li>在计算损失时，对于每个所筛选的前景锚点（即物体中心所处的锚点），都对应一个标签，标签由3部分组成：前景锚点的序号（即哪个锚点对应当前物体，会利用GIoU做加权处理），中心坐标偏移量，边界框在特征图上的宽高，其中中心坐标偏移量与前景锚点序号具有对应关系，因此这里需要得到每个锚点的置信度、预测数据的中心坐标<code>x、y</code>的偏移量以及预测的宽高<code>w、h</code>；</li>
<li>坐标偏移量利用GIoU损失优化，分类损失（包括前景分类）利用交叉熵损失优化。</li>
</ul>
<h3 id="_5">网络结构<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Darknet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    YOLOv3 spp object detection model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">img_size</span><span class="o">=</span><span class="p">(</span><span class="mi">416</span><span class="p">,</span> <span class="mi">416</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Darknet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># 这里传入的img_size只在导出ONNX模型时起作用</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">img_size</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">img_size</span>
        <span class="c1"># 解析网络对应的.cfg文件</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module_defs</span> <span class="o">=</span> <span class="n">parse_model_cfg</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="c1"># 根据解析的网络结构一层一层去搭建</span>
        <span class="c1"># self.module_list表示构建的模块；self.routs用于记录哪些层的特征图可能会后续被用到</span>
        <span class="c1"># 如残差结构的特征融合，或特征拼接（类似FPN结构）</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">routs</span> <span class="o">=</span> <span class="n">create_modules</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_defs</span><span class="p">,</span> <span class="n">img_size</span><span class="p">)</span>
        <span class="c1"># 获取所有YOLOLayer层的索引</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yolo_layers</span> <span class="o">=</span> <span class="n">get_yolo_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># 打印下模型的信息，如果verbose为True则打印详细信息</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ONNX_EXPORT</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># print model description</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_once</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># yolo_out收集每个yolo_layer层的输出</span>
        <span class="c1"># out收集每个模块的输出</span>
        <span class="n">yolo_out</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># 遍历网络中所有的模块</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_list</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="c1"># 判断是否执行残差求和 或 特征拼接</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;WeightedFeatureFusion&quot;</span><span class="p">,</span> <span class="s2">&quot;FeatureConcat&quot;</span><span class="p">]:</span>  <span class="c1"># sum, concat</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">module</span><span class="o">.</span><span class="n">layers</span>  <span class="c1"># layers</span>
                    <span class="n">sh</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">layers</span><span class="p">]</span>  <span class="c1"># shapes</span>
                    <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39; &gt;&gt; &#39;</span> <span class="o">+</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;layer </span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">sh</span><span class="p">)])</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">module</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>  <span class="c1"># WeightedFeatureFusion(), FeatureConcat()</span>
            <span class="c1"># 预测层预测，预测结果存入yolo_out中</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;YOLOLayer&quot;</span><span class="p">:</span>
                <span class="n">yolo_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># run module directly, i.e. mtype = &#39;convolutional&#39;, &#39;upsample&#39;, &#39;maxpool&#39;, &#39;batchnorm2d&#39; etc.</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">module</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="c1"># out保存每个模块的输出</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">routs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">else</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">/</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> -&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_list</span><span class="p">),</span> <span class="n">name</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
                <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>  <span class="c1"># train</span>
            <span class="k">return</span> <span class="n">yolo_out</span>
        <span class="k">elif</span> <span class="n">ONNX_EXPORT</span><span class="p">:</span>  <span class="c1"># export</span>
            <span class="c1"># x = [torch.cat(x, 0) for x in zip(*yolo_out)]</span>
            <span class="c1"># return x[0], torch.cat(x[1:3], 1)  # scores, boxes: 3780x80, 3780x4</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">yolo_out</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># # 根据objectness虑除低概率目标</span>
            <span class="c1"># mask = torch.nonzero(torch.gt(p[:, 4], 0.1), as_tuple=False).squeeze(1)</span>
            <span class="c1"># # onnx不支持超过一维的索引（pytorch太灵活了）</span>
            <span class="c1"># # p = p[mask]</span>
            <span class="c1"># p = torch.index_select(p, dim=0, index=mask)</span>
            <span class="c1">#</span>
            <span class="c1"># # 虑除小面积目标，w &gt; 2 and h &gt; 2 pixel</span>
            <span class="c1"># # ONNX暂不支持bitwise_and和all操作</span>
            <span class="c1"># mask_s = torch.gt(p[:, 2], 2./self.input_size[0]) &amp; torch.gt(p[:, 3], 2./self.input_size[1])</span>
            <span class="c1"># mask_s = torch.nonzero(mask_s, as_tuple=False).squeeze(1)</span>
            <span class="c1"># p = torch.index_select(p, dim=0, index=mask_s)  # width-height 虑除小目标</span>
            <span class="c1">#</span>
            <span class="c1"># if mask_s.numel() == 0:</span>
            <span class="c1">#     return torch.empty([0, 85])</span>

            <span class="k">return</span> <span class="n">p</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># inference or test</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">yolo_out</span><span class="p">)</span>  <span class="c1"># inference output, training output</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># cat yolo outputs</span>

            <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        打印模型的信息</span>
<span class="sd">        :param verbose:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">torch_utils</span><span class="o">.</span><span class="n">model_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_yolo_layers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    获取网络中三个&quot;YOLOLayer&quot;模块对应的索引</span>
<span class="sd">    :param self:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;YOLOLayer&#39;</span><span class="p">]</span>  <span class="c1"># [89, 101, 113]</span>
</code></pre></div>
<h4 id="_6">定义所有模块<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">create_modules</span><span class="p">(</span><span class="n">modules_defs</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">img_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs module list of layer blocks from module configuration in module_defs</span>
<span class="sd">    :param modules_defs: 通过.cfg文件解析得到的每个层结构的列表</span>
<span class="sd">    :param img_size:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">img_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">img_size</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">img_size</span>
    <span class="c1"># 删除解析cfg列表中的第一个配置(对应[net]的配置)</span>
    <span class="n">modules_defs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># cfg training hyperparams (unused)</span>
    <span class="n">output_filters</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># input channels，用于存储每个层输出的特征图通道数，第一层为输入层，相当于是图片，通道数为3</span>
    <span class="n">module_list</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
    <span class="c1"># 统计哪些特征层的输出会被后续的层使用到(可能是特征融合，也可能是拼接)</span>
    <span class="n">routs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of layers which rout to deeper layers</span>
    <span class="n">yolo_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># 遍历搭建每个层结构，逐一构建</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mdef</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modules_defs</span><span class="p">):</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;convolutional&quot;</span><span class="p">:</span>
            <span class="n">bn</span> <span class="o">=</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;batch_normalize&quot;</span><span class="p">]</span>  <span class="c1"># 1 or 0 / use or not，1表示使用BN，0表示不使用</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;filters&quot;</span><span class="p">]</span> <span class="c1"># 卷积核的个数，即当前卷积层输出的通道数</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>  <span class="c1"># kernel size</span>
            <span class="n">stride</span> <span class="o">=</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;stride&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;stride&quot;</span> <span class="ow">in</span> <span class="n">mdef</span> <span class="k">else</span> <span class="p">(</span><span class="n">mdef</span><span class="p">[</span><span class="s1">&#39;stride_y&#39;</span><span class="p">],</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;stride_x&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="c1"># mdef[&quot;pad&quot;]表示是否启用padding</span>
                <span class="n">modules</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;Conv2d&quot;</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">output_filters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">out_channels</span><span class="o">=</span><span class="n">filters</span><span class="p">,</span>
                                                       <span class="n">kernel_size</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
                                                       <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span>
                                                       <span class="n">padding</span><span class="o">=</span><span class="n">k</span> <span class="o">//</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;pad&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                                                       <span class="n">bias</span><span class="o">=</span><span class="ow">not</span> <span class="n">bn</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;conv2d filter size must be int type.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bn</span><span class="p">:</span>
                <span class="n">modules</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;BatchNorm2d&quot;</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 如果该卷积操作没有bn层，意味着该层为yolo的predictor（除了预测层，所有的卷积层都接BN层）</span>
                <span class="n">routs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># detection output (goes into yolo layer)</span>

            <span class="k">if</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;activation&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;leaky&quot;</span><span class="p">:</span>  <span class="c1"># 和BN一样，正常的卷积层都接leaky</span>
                <span class="n">modules</span><span class="o">.</span><span class="n">add_module</span><span class="p">(</span><span class="s2">&quot;activation&quot;</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BatchNorm2d&quot;</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># spp结构，多个maxpool并联</span>
        <span class="k">elif</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;maxpool&quot;</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span>  <span class="c1"># kernel size</span>
            <span class="n">stride</span> <span class="o">=</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;stride&quot;</span><span class="p">]</span>
            <span class="n">modules</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;upsample&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ONNX_EXPORT</span><span class="p">:</span>  <span class="c1"># explicitly state size, avoid scale_factor</span>
                <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">yolo_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">32</span>  <span class="c1"># gain</span>
                <span class="n">modules</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Upsample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">img_size</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">modules</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Upsample</span><span class="p">(</span><span class="n">scale_factor</span><span class="o">=</span><span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;stride&quot;</span><span class="p">])</span>

        <span class="c1"># 一个值时表示指向某一层的输出，多个值时表示拼接多层的输出</span>
        <span class="c1"># 用于拼接多个预测层的特征数据，类似FPN结构</span>
        <span class="k">elif</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;route&quot;</span><span class="p">:</span>  <span class="c1"># [-2],  [-1,-3,-5,-6], [-1, 61]</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;layers&quot;</span><span class="p">]</span>
            <span class="c1"># +1表示加上输入层那个序号</span>
            <span class="c1"># filters表示当前层输出特征图通道数，有拼接操作的话就要将多个通道数求和</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">output_filters</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">l</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">])</span>
            <span class="c1"># i表示当前层</span>
            <span class="n">routs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">i</span> <span class="o">+</span> <span class="n">l</span> <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">])</span> <span class="c1"># 记录使用哪些层的输出</span>
            <span class="n">modules</span> <span class="o">=</span> <span class="n">FeatureConcat</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">)</span>

        <span class="c1"># 相当于是残差连接</span>
        <span class="k">elif</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;shortcut&quot;</span><span class="p">:</span>
            <span class="c1"># 一般是以前面数第三个模块输出的特征图做残差连接，也就是layers=-3</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span>
            <span class="c1"># 提取上一层输出特征的特征图通道数</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="n">output_filters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># routs.extend([i + l if l &lt; 0 else l for l in layers])</span>
            <span class="n">routs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">modules</span> <span class="o">=</span> <span class="n">WeightedFeatureFusion</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;weights_type&quot;</span> <span class="ow">in</span> <span class="n">mdef</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;yolo&quot;</span><span class="p">:</span>
            <span class="c1"># 也就是预测特征层</span>
            <span class="n">yolo_index</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># 记录是第几个yolo_layer [0, 1, 2]</span>
            <span class="n">stride</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>  <span class="c1"># 预测特征层对应原图的缩放比例，相当于感受野</span>

            <span class="c1"># anchor个数和预测个数相关</span>
            <span class="c1"># mdef[&quot;anchors&quot;][mdef[&quot;mask&quot;]传入的是当前预测层的锚点宽高尺寸</span>
            <span class="n">modules</span> <span class="o">=</span> <span class="n">YOLOLayer</span><span class="p">(</span><span class="n">anchors</span><span class="o">=</span><span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;anchors&quot;</span><span class="p">][</span><span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]],</span>  <span class="c1"># anchor list</span>
                                <span class="n">nc</span><span class="o">=</span><span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;classes&quot;</span><span class="p">],</span>  <span class="c1"># number of classes</span>
                                <span class="n">img_size</span><span class="o">=</span><span class="n">img_size</span><span class="p">,</span>
                                <span class="n">stride</span><span class="o">=</span><span class="n">stride</span><span class="p">[</span><span class="n">yolo_index</span><span class="p">])</span>

            <span class="c1"># Initialize preceding Conv2d() bias (https://arxiv.org/pdf/1708.02002.pdf section 3.3)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># 对预测层做初始化</span>
                <span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="c1"># bias: shape(255,) 索引0对应Sequential中的Conv2d</span>
                <span class="c1"># view: shape(3, 85)，这里b就相当于提取了conv2d中的偏置参数</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">module_list</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">modules</span><span class="o">.</span><span class="n">na</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">b</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mf">4.5</span>  <span class="c1"># obj</span>
                <span class="n">b</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:]</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.6</span> <span class="o">/</span> <span class="p">(</span><span class="n">modules</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span> <span class="mf">0.99</span><span class="p">))</span>  <span class="c1"># cls (sigmoid(p) = 1/nc)</span>
                <span class="n">module_list</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: smart bias initialization failure.&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: Unrecognized Layer Type: &quot;</span> <span class="o">+</span> <span class="n">mdef</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span>

        <span class="c1"># Register module list and number of output filters</span>
        <span class="c1"># 将构建的预测模块放进去</span>
        <span class="n">module_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span>
        <span class="n">output_filters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>

    <span class="n">routs_binary</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">modules_defs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">routs</span><span class="p">:</span>
        <span class="c1"># 这里routs_binary用于统计哪些特征层的输出会被后续的层使用到(可能是特征融合，也可能是拼接)</span>
        <span class="c1"># 会被用到的设为True</span>
        <span class="n">routs_binary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">module_list</span><span class="p">,</span> <span class="n">routs_binary</span>
</code></pre></div>
<h4 id="_7">定义特征融合操作<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p>包括残差结构的融合、特征图的拼接</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">FeatureConcat</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    将多个特征矩阵在channel维度进行concatenate拼接</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FeatureConcat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">layers</span>  <span class="c1"># layer indices</span>
        <span class="c1"># self.multiple用于判断是合并多个输出特征还是引出当前输出层</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiple</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>  <span class="c1"># multiple layers flag</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="c1"># 这里的outputs是正向传播时传入的，和定义网络时的outputs不一样</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple</span> <span class="k">else</span> <span class="n">outputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>


<span class="k">class</span> <span class="nc">WeightedFeatureFusion</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>  <span class="c1"># weighted sum of 2 or more layers https://arxiv.org/abs/1911.09070</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    将多个特征矩阵的值进行融合(add操作)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WeightedFeatureFusion</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">layers</span>  <span class="c1"># layer indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>  <span class="c1"># apply weights boolean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># number of layers 融合的特征矩阵个数</span>
        <span class="k">if</span> <span class="n">weight</span><span class="p">:</span> <span class="c1"># 默认不额外设置weight，只作纯加法</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># layer weights</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">outputs</span><span class="p">):</span>
        <span class="c1"># Weights</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>  <span class="c1"># sigmoid weights (0-1)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Fusion</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># input channels</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># outputs表示用于融合的特征(一般是前几层)，x表示当前层特征</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="k">else</span> <span class="n">outputs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  <span class="c1"># feature to add</span>
            <span class="n">na</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># feature channels</span>

            <span class="c1"># Adjust channels</span>
            <span class="c1"># 根据相加的两个特征矩阵的channel选择相加方式</span>
            <span class="k">if</span> <span class="n">nx</span> <span class="o">==</span> <span class="n">na</span><span class="p">:</span>  <span class="c1"># same shape 如果channel相同，直接相加</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a</span>  <span class="c1"># 一般是用这个分支，直接相加</span>
            <span class="k">elif</span> <span class="n">nx</span> <span class="o">&gt;</span> <span class="n">na</span><span class="p">:</span>  <span class="c1"># slice input 如果channel不同，将channel多的特征矩阵砍掉部分channel保证相加的channel一致</span>
                <span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="n">na</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:</span><span class="n">na</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span>  <span class="c1"># or a = nn.ZeroPad2d((0, 0, 0, 0, 0, dc))(a); x = x + a</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># slice feature</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">a</span><span class="p">[:,</span> <span class="p">:</span><span class="n">nx</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">x</span>
</code></pre></div>
<h4 id="_8">定义预测层<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">YOLOLayer</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    对YOLO的输出进行处理</span>
<span class="sd">    注意:预测数值已经由YOLOLayer的上一层完成，具体可见my_yolov3.cfg文件</span>
<span class="sd">    YOLOLayer只是用于生成网格坐标数据，即锚点图，测试阶段中，锚点图和上一层预测的数据结合可以得到真实坐标数据</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchors</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">img_size</span><span class="p">,</span> <span class="n">stride</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">YOLOLayer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># anchors表示当前预测层锚点的宽高尺寸</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">anchors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">stride</span>  <span class="c1"># layer stride 特征图上一步对应原图上的步距 [32, 16, 8]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">na</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">anchors</span><span class="p">)</span>  <span class="c1"># 锚点的个数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="n">nc</span>  <span class="c1"># 类别个数 number of classes (80) coco默认80</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no</span> <span class="o">=</span> <span class="n">nc</span> <span class="o">+</span> <span class="mi">5</span>  <span class="c1"># 每个锚点对应多少个输出数据，和类别数相关number of outputs (85: x, y, w, h, obj, cls1, ...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ng</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># initialize number of x, y gridpoints</span>
        <span class="c1"># 将anchors大小缩放到grid尺度</span>
        <span class="c1"># 传入的anchors都是在原图上的尺度数据，这里除以self.stride表明转为当前特征图尺度</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchors</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span>
        <span class="c1"># batch_size, na, grid_h, grid_w(网格高宽), wh,</span>
        <span class="c1"># 值为1的维度对应的值不是固定值，后续操作可根据broadcast广播机制自动扩充</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anchor_wh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_vec</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">na</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">ONNX_EXPORT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_grids</span><span class="p">((</span><span class="n">img_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">stride</span><span class="p">,</span> <span class="n">img_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">stride</span><span class="p">))</span>  <span class="c1"># number x, y grid points</span>

    <span class="k">def</span> <span class="nf">create_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ng</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        更新grids信息并生成新的grids参数</span>
<span class="sd">        :param ng: 特征图大小</span>
<span class="sd">        :param device:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">=</span> <span class="n">ng</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ng</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

        <span class="c1"># build xy offsets 构建每个cell处的anchor的xy偏移量(在feature map上的)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>  <span class="c1"># 训练模式不需要回归到最终预测boxes</span>
            <span class="c1"># 网格的x坐标和y坐标（每个网格的左上角坐标，每个格子表示一个像素点，因此这里坐标间距为1）</span>
            <span class="n">yv</span><span class="p">,</span> <span class="n">xv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span>
                                     <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)])</span>
            <span class="c1"># 尺寸为(batch_size, na, grid_h, grid_w, wh)，wh表示xy坐标，有两个值</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">xv</span><span class="p">,</span> <span class="n">yv</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_vec</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">device</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anchor_vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_vec</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anchor_wh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_wh</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="c1"># p表示预测结果</span>
    <span class="c1"># 训练阶段只需要调整一下尺寸（根据锚点预设情况调整），直接返回即可</span>
    <span class="c1"># 测试阶段需要和锚点坐标相结合，计算得到原图上的绝对坐标值</span>
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ONNX_EXPORT</span><span class="p">:</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># batch size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ny，nx分别表示预测特征图的高宽，间接体现了参与预测的锚点数量</span>
            <span class="c1"># ny*nx*每个特征点上的锚点数量=锚点总数，对应p的第二维度尺寸，这里为75</span>
            <span class="n">bs</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># batch_size, predict_param(255), grid(13), grid(13)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># fix no grid bug</span>
                <span class="c1"># 先将特征图尺寸</span>
                <span class="c1"># 测试阶段中，利用预测特征图尺寸计算网格序号，存入self中，后续和预测结果结合，生成边界框坐标值</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_grids</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">),</span> <span class="n">p</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="c1"># view: (batch_size, 255, 13, 13) -&gt; (batch_size, 3, 85, 13, 13)</span>
        <span class="c1"># permute: (batch_size, 3, 85, 13, 13) -&gt; (batch_size, 3, 13, 13, 85)</span>
        <span class="c1"># [bs, anchor, grid, grid, xywh + obj + classes]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">na</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>  <span class="c1"># prediction</span>
        <span class="c1"># self.training=False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span>
        <span class="k">elif</span> <span class="n">ONNX_EXPORT</span><span class="p">:</span>
            <span class="c1"># Avoid broadcasting for ANE operations</span>
            <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">na</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span>  <span class="c1"># 3*</span>
            <span class="n">ng</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">ng</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">na</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">anchor_wh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_wh</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">ng</span>

            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no</span><span class="p">)</span>
            <span class="c1"># xy = torch.sigmoid(p[:, 0:2]) + grid  # x, y</span>
            <span class="c1"># wh = torch.exp(p[:, 2:4]) * anchor_wh  # width, height</span>
            <span class="c1"># p_cls = torch.sigmoid(p[:, 4:5]) if self.nc == 1 else \</span>
            <span class="c1">#     torch.sigmoid(p[:, 5:self.no]) * torch.sigmoid(p[:, 4:5])  # conf</span>
            <span class="n">p</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">grid</span><span class="p">)</span> <span class="o">*</span> <span class="n">ng</span>  <span class="c1"># x, y</span>
            <span class="n">p</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="n">anchor_wh</span>  <span class="c1"># width, height</span>
            <span class="n">p</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:])</span>
            <span class="n">p</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">no</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># inference 测试模式，预测结果和网格坐标结合，得到绝对坐标</span>
            <span class="c1"># [bs, anchor, grid, grid, xywh + obj + classes]</span>
            <span class="n">io</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>  <span class="c1"># inference output</span>
            <span class="c1"># ...表示其他维度均全选</span>
            <span class="c1"># 计算在feature map上的xy坐标</span>
            <span class="c1"># 这里以及下面都是得到相对坐标，相对于特征图尺寸的坐标，后续再乘以步长就可以得到原图上的绝对坐标</span>
            <span class="n">io</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">io</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span>  <span class="c1"># xy</span>
            <span class="c1"># 计算在feature map上的wh</span>
            <span class="n">io</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">io</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">anchor_wh</span>  <span class="c1"># wh yolo method</span>
            <span class="c1"># 换算映射回原图尺度，转换成原图的绝对坐标</span>
            <span class="n">io</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span>
            <span class="c1"># 将分类结果传入sigmoid，这里也包括前景置信度分类结果</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid_</span><span class="p">(</span><span class="n">io</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">:])</span>
            <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">no</span><span class="p">),</span> <span class="n">p</span>  <span class="c1"># view [1, 3, 13, 13, 85] as [1, 507, 85]</span>
</code></pre></div>
<h3 id="_9">损失的计算<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>  <span class="c1"># predictions, targets, model</span>
    <span class="c1"># 传入预测值和物体标签数据，这里标签含图片序号(一个batch内部)、物体类别、边界框坐标数据(相对坐标，数值范围从0-1)</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span>
    <span class="n">lcls</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># Tensor(0)</span>
    <span class="n">lbox</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># Tensor(0)</span>
    <span class="n">lobj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># Tensor(0)</span>
    <span class="c1"># tcls表示物体类别</span>
    <span class="c1"># tbox表示gt box相对anchor的x,y偏移量以及w,h(w,h不是偏移量，是特征图上边界框的宽高)</span>
    <span class="c1"># indices表示序号，存有[图片序号，锚点序号(当前物体和第几个锚地匹配)，网格序号(对应横纵坐标两个数据)]</span>
    <span class="c1"># anch存有锚点宽高尺寸(相对于特征图而言)</span>
    <span class="n">tcls</span><span class="p">,</span> <span class="n">tbox</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">anchors</span> <span class="o">=</span> <span class="n">build_targets</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>  <span class="c1"># targets</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">hyp</span>  <span class="c1"># hyperparameters</span>
    <span class="n">red</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>  <span class="c1"># Loss reduction (sum or mean)</span>

    <span class="c1"># Define criteria</span>
    <span class="n">BCEcls</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">(</span><span class="n">pos_weight</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;cls_pw&#39;</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="n">reduction</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>
    <span class="n">BCEobj</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">(</span><span class="n">pos_weight</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">h</span><span class="p">[</span><span class="s1">&#39;obj_pw&#39;</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="n">reduction</span><span class="o">=</span><span class="n">red</span><span class="p">)</span>

    <span class="c1"># class label smoothing https://arxiv.org/pdf/1902.04103.pdf eqn 3</span>
    <span class="n">cp</span><span class="p">,</span> <span class="n">cn</span> <span class="o">=</span> <span class="n">smooth_BCE</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="c1"># focal loss</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;fl_gamma&#39;</span><span class="p">]</span>  <span class="c1"># focal loss gamma</span>
    <span class="c1"># fl_gamma大于0就表示使用focal loss，默认不使用</span>
    <span class="k">if</span> <span class="n">g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">BCEcls</span><span class="p">,</span> <span class="n">BCEobj</span> <span class="o">=</span> <span class="n">FocalLoss</span><span class="p">(</span><span class="n">BCEcls</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="n">FocalLoss</span><span class="p">(</span><span class="n">BCEobj</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

    <span class="c1"># per output</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>  <span class="c1"># layer index, layer predictions</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gj</span><span class="p">,</span> <span class="n">gi</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># image_idx, anchor_idx, grid_y, grid_x</span>
        <span class="n">tobj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># target obj</span>

        <span class="n">nb</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># number of positive samples</span>
        <span class="k">if</span> <span class="n">nb</span><span class="p">:</span>
            <span class="c1"># 对应匹配到正样本的预测信息</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="n">pi</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gj</span><span class="p">,</span> <span class="n">gi</span><span class="p">]</span>  <span class="c1"># prediction subset corresponding to targets</span>

            <span class="c1"># GIoU 计算GIoU值</span>
            <span class="c1"># 计算预测的x,y的偏移量</span>
            <span class="n">pxy</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">()</span>
            <span class="c1"># 结合锚点情况 计算预测得到的w、h</span>
            <span class="n">pwh</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="mf">1E3</span><span class="p">)</span> <span class="o">*</span> <span class="n">anchors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">pbox</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">pxy</span><span class="p">,</span> <span class="n">pwh</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># predicted box</span>
            <span class="c1"># 计算giou值</span>
            <span class="n">giou</span> <span class="o">=</span> <span class="n">bbox_iou</span><span class="p">(</span><span class="n">pbox</span><span class="o">.</span><span class="n">t</span><span class="p">(),</span> <span class="n">tbox</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x1y1x2y2</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">GIoU</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># giou(prediction, target)</span>
            <span class="n">lbox</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">giou</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># giou loss</span>

            <span class="c1"># Obj</span>
            <span class="c1"># 利用GIOU对匹配到的前景锚点加权处理，表示相交的部分越大，置信度越大</span>
            <span class="n">tobj</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gj</span><span class="p">,</span> <span class="n">gi</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">model</span><span class="o">.</span><span class="n">gr</span><span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">gr</span> <span class="o">*</span> <span class="n">giou</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">tobj</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>  <span class="c1"># giou ratio</span>

            <span class="c1"># Class，只有类别数大于1时，才启用分类器</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">nc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># cls loss (only if multiple classes)</span>
                <span class="c1"># 将类别序号转为独热编码</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:],</span> <span class="n">cn</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>  <span class="c1"># targets</span>
                <span class="n">t</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">nb</span><span class="p">),</span> <span class="n">tcls</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cp</span>
                <span class="c1"># 每个类依次做二元交叉熵损失</span>
                <span class="c1"># 5:表示只提取类别预测分数</span>
                <span class="n">lcls</span> <span class="o">+=</span> <span class="n">BCEcls</span><span class="p">(</span><span class="n">ps</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:],</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># BCE</span>

            <span class="c1"># Append targets to text file</span>
            <span class="c1"># with open(&#39;targets.txt&#39;, &#39;a&#39;) as file:</span>
            <span class="c1">#     [file.write(&#39;%11.5g &#39; * 4 % tuple(x) + &#39;\n&#39;) for x in torch.cat((txy[i], twh[i]), 1)]</span>
        <span class="c1"># 置信度损失，4表示取出第五个数值，对应预测的置信度</span>
        <span class="c1"># tobj是置信度标签，大部分数是0，前景锚点取值范围为0-1</span>
        <span class="n">lobj</span> <span class="o">+=</span> <span class="n">BCEobj</span><span class="p">(</span><span class="n">pi</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">tobj</span><span class="p">)</span>  <span class="c1"># obj loss</span>

    <span class="c1"># 乘上每种损失的对应权重</span>
    <span class="n">lbox</span> <span class="o">*=</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;giou&#39;</span><span class="p">]</span>
    <span class="n">lobj</span> <span class="o">*=</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;obj&#39;</span><span class="p">]</span>
    <span class="n">lcls</span> <span class="o">*=</span> <span class="n">h</span><span class="p">[</span><span class="s1">&#39;cls&#39;</span><span class="p">]</span>

    <span class="c1"># loss = lbox + lobj + lcls</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;box_loss&quot;</span><span class="p">:</span> <span class="n">lbox</span><span class="p">,</span>
            <span class="s2">&quot;obj_loss&quot;</span><span class="p">:</span> <span class="n">lobj</span><span class="p">,</span>
            <span class="s2">&quot;class_loss&quot;</span><span class="p">:</span> <span class="n">lcls</span><span class="p">}</span>
</code></pre></div>
<h4 id="_10">标签数据的匹配<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_targets</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="c1"># Build targets for compute_loss(), input targets(image_idx,class,x,y,w,h)</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tcls</span><span class="p">,</span> <span class="n">tbox</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">anch</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">targets</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>  <span class="c1"># normalized to gridspace gain</span>

    <span class="n">multi_gpu</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">DataParallel</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">parallel</span><span class="o">.</span><span class="n">DistributedDataParallel</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">yolo_layers</span><span class="p">):</span>  <span class="c1"># j: [89, 101, 113]</span>
        <span class="c1"># 获取该yolo predictor对应的anchors</span>
        <span class="c1"># 注意anchor_vec是anchors缩放到对应特征层上的尺度，因此这里的锚点尺寸是相对于特征图的尺寸(特征图上每个像素点之间的距离视为1)</span>
        <span class="n">anchors</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">module_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">anchor_vec</span> <span class="k">if</span> <span class="n">multi_gpu</span> <span class="k">else</span> <span class="n">model</span><span class="o">.</span><span class="n">module_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">anchor_vec</span>
        <span class="c1"># p[i].shape: [batch_size, 3, grid_h, grid_w, num_params]</span>
        <span class="c1"># gain表示预测特征层的尺寸，后续和targets中储存的相对坐标相乘，会得到特征图上的绝对坐标</span>
        <span class="n">gain</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>  <span class="c1"># xyxy gain</span>
        <span class="n">na</span> <span class="o">=</span> <span class="n">anchors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># number of anchors，默认3</span>
        <span class="c1"># [3] -&gt; [3, 1] -&gt; [3, nt]</span>
        <span class="n">at</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">na</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">na</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nt</span><span class="p">)</span>  <span class="c1"># anchor tensor, same as .repeat_interleave(nt)</span>

        <span class="c1"># t表示特征图上target的绝对坐标，targets相对坐标乘以特征图尺寸得到</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">offsets</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">targets</span> <span class="o">*</span> <span class="n">gain</span><span class="p">,</span> <span class="mi">0</span>
        <span class="c1"># Match targets to anchors，将标签和锚点做匹配</span>
        <span class="k">if</span> <span class="n">nt</span><span class="p">:</span>
            <span class="c1"># 通过计算anchor模板与所有target的wh_iou来匹配正样本</span>
            <span class="c1"># j: [3, nt] , iou_t = 0.20</span>
            <span class="c1"># 如果存在target的话，这里先将target中所有的目标与锚点做一次匹配</span>
            <span class="c1"># 每个目标匹配一个锚点模板，匹配出与目标边界框宽高比例像的锚点模板</span>
            <span class="c1"># j里行表示每个特征上的锚点数量，列表书target目标数量</span>
            <span class="c1"># True所在的行表示与target目标(所在的列)所匹配的锚点模板序号</span>
            <span class="c1"># 注意，这里只是讲target和锚点模板匹配，并不会得到和网格中第几个锚点匹配</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">wh_iou</span><span class="p">(</span><span class="n">anchors</span><span class="p">,</span> <span class="n">t</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">model</span><span class="o">.</span><span class="n">hyp</span><span class="p">[</span><span class="s1">&#39;iou_t&#39;</span><span class="p">]</span>  <span class="c1"># iou(3,n) = wh_iou(anchors(3,2), gwh(n,2))</span>
            <span class="c1"># t.repeat(na, 1, 1): [nt, 6] -&gt; [3, nt, 6]</span>
            <span class="c1"># 获取正样本对应的anchor模板与target信息(先粗略将匹配的锚点模板表示为正类锚点)</span>
            <span class="c1"># 若一个边界框标签匹配到多个锚点模板，则对应t会被“复制”多次</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">at</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">na</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># filter</span>

        <span class="c1"># Define</span>
        <span class="c1"># long等于to(torch.int64), 数值向下取整</span>
        <span class="c1"># b、c分别表示:图片序号image_idx(一个batch内的序号), 物体类别class</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">long</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># target的中心坐标，物体边界框的中点</span>
        <span class="n">gxy</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># grid xy</span>
        <span class="c1"># 物体边界框的宽高(相对于特征图而言)</span>
        <span class="n">gwh</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># grid wh</span>
        <span class="c1"># 匹配targets所在的grid cell左上角坐标</span>
        <span class="c1"># 上下取整，得到左上角坐标</span>
        <span class="n">gij</span> <span class="o">=</span> <span class="p">(</span><span class="n">gxy</span> <span class="o">-</span> <span class="n">offsets</span><span class="p">)</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
        <span class="n">gi</span><span class="p">,</span> <span class="n">gj</span> <span class="o">=</span> <span class="n">gij</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># grid xy indices</span>

        <span class="c1"># Append</span>
        <span class="c1"># gain[3]: grid_h, gain[2]: grid_w</span>
        <span class="c1"># image_idx, anchor_idx, grid indices(y, x)</span>
        <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">gj</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">gi</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
        <span class="c1"># gt box相对anchor的x,y偏移量以及w,h</span>
        <span class="n">tbox</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">gxy</span> <span class="o">-</span> <span class="n">gij</span><span class="p">,</span> <span class="n">gwh</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">anch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">anchors</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>  <span class="c1"># anchors</span>
        <span class="n">tcls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># class</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># if any targets</span>
            <span class="c1"># 目标的标签数值不能大于给定的目标类别数</span>
            <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">model</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="s1">&#39;Model accepts </span><span class="si">%g</span><span class="s1"> classes labeled from 0-</span><span class="si">%g</span><span class="s1">, however you labelled a class </span><span class="si">%g</span><span class="s1">. &#39;</span> \
                                       <span class="s1">&#39;See https://github.com/ultralytics/yolov3/wiki/Train-Custom-Data&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                           <span class="n">model</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="c1"># tcls表示物体类别</span>
    <span class="c1"># tbox表示gt box相对anchor的x,y偏移量以及w,h(w,h不是偏移量，是特征图上边界框的宽高)</span>
    <span class="c1"># indices表示序号，存有[图片序号，锚点序号(当前物体和第几个锚地匹配)，网格序号(前景锚点的位置，对应横纵坐标两个数据)]</span>
    <span class="c1"># anch存有锚点宽高尺寸(相对于特征图而言)</span>
    <span class="k">return</span> <span class="n">tcls</span><span class="p">,</span> <span class="n">tbox</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">anch</span>
</code></pre></div>
<p><strong>计算GIoU</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># 这里传入中心坐标的偏移量、以及每个边界框的宽高</span>
<span class="c1"># 由于box1和box2对应位置的中心坐标是相同的，因此偏移量在这里可以看成中心坐标</span>
<span class="k">def</span> <span class="nf">bbox_iou</span><span class="p">(</span><span class="n">box1</span><span class="p">,</span> <span class="n">box2</span><span class="p">,</span> <span class="n">x1y1x2y2</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">GIoU</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">DIoU</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">CIoU</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># Returns the IoU of box1 to box2. box1 is 4, box2 is nx4</span>
    <span class="n">box2</span> <span class="o">=</span> <span class="n">box2</span><span class="o">.</span><span class="n">t</span><span class="p">()</span>

    <span class="c1"># Get the coordinates of bounding boxes</span>
    <span class="k">if</span> <span class="n">x1y1x2y2</span><span class="p">:</span>  <span class="c1"># x1, y1, x2, y2 = box1</span>
        <span class="n">b1_x1</span><span class="p">,</span> <span class="n">b1_y1</span><span class="p">,</span> <span class="n">b1_x2</span><span class="p">,</span> <span class="n">b1_y2</span> <span class="o">=</span> <span class="n">box1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">b2_x1</span><span class="p">,</span> <span class="n">b2_y1</span><span class="p">,</span> <span class="n">b2_x2</span><span class="p">,</span> <span class="n">b2_y2</span> <span class="o">=</span> <span class="n">box2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">box2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># transform from xywh to xyxy</span>
        <span class="n">b1_x1</span><span class="p">,</span> <span class="n">b1_x2</span> <span class="o">=</span> <span class="n">box1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">box1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">box1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">box1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">b1_y1</span><span class="p">,</span> <span class="n">b1_y2</span> <span class="o">=</span> <span class="n">box1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">box1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">box1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">box1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">b2_x1</span><span class="p">,</span> <span class="n">b2_x2</span> <span class="o">=</span> <span class="n">box2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">box2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">box2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">box2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">b2_y1</span><span class="p">,</span> <span class="n">b2_y2</span> <span class="o">=</span> <span class="n">box2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">box2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">box2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">box2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Intersection area</span>
    <span class="c1"># 计算相交区域的面积</span>
    <span class="n">inter</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">b1_x2</span><span class="p">,</span> <span class="n">b2_x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">b1_x1</span><span class="p">,</span> <span class="n">b2_x1</span><span class="p">))</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">b1_y2</span><span class="p">,</span> <span class="n">b2_y2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">b1_y1</span><span class="p">,</span> <span class="n">b2_y1</span><span class="p">))</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Union Area</span>
    <span class="c1"># 计算相并区域的面积，两个边界框面积相加，再减去相交的面积，类似容斥定理</span>
    <span class="n">w1</span><span class="p">,</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">b1_x2</span> <span class="o">-</span> <span class="n">b1_x1</span><span class="p">,</span> <span class="n">b1_y2</span> <span class="o">-</span> <span class="n">b1_y1</span>
    <span class="n">w2</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">b2_x2</span> <span class="o">-</span> <span class="n">b2_x1</span><span class="p">,</span> <span class="n">b2_y2</span> <span class="o">-</span> <span class="n">b2_y1</span>
    <span class="n">union</span> <span class="o">=</span> <span class="p">(</span><span class="n">w1</span> <span class="o">*</span> <span class="n">h1</span> <span class="o">+</span> <span class="mf">1e-16</span><span class="p">)</span> <span class="o">+</span> <span class="n">w2</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">-</span> <span class="n">inter</span>

    <span class="c1"># 得到iou值</span>
    <span class="n">iou</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">/</span> <span class="n">union</span>  <span class="c1"># iou</span>
    <span class="k">if</span> <span class="n">GIoU</span> <span class="ow">or</span> <span class="n">DIoU</span> <span class="ow">or</span> <span class="n">CIoU</span><span class="p">:</span>
        <span class="c1"># 计算大边界框的宽高，进一步计算面积</span>
        <span class="n">cw</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">b1_x2</span><span class="p">,</span> <span class="n">b2_x2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">b1_x1</span><span class="p">,</span> <span class="n">b2_x1</span><span class="p">)</span>  <span class="c1"># convex (smallest enclosing box) width</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">b1_y2</span><span class="p">,</span> <span class="n">b2_y2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">b1_y1</span><span class="p">,</span> <span class="n">b2_y1</span><span class="p">)</span>  <span class="c1"># convex height</span>
        <span class="k">if</span> <span class="n">GIoU</span><span class="p">:</span>  <span class="c1"># Generalized IoU https://arxiv.org/pdf/1902.09630.pdf</span>
            <span class="n">c_area</span> <span class="o">=</span> <span class="n">cw</span> <span class="o">*</span> <span class="n">ch</span> <span class="o">+</span> <span class="mf">1e-16</span>  <span class="c1"># convex area</span>
            <span class="c1"># 返回GIoU</span>
            <span class="k">return</span> <span class="n">iou</span> <span class="o">-</span> <span class="p">(</span><span class="n">c_area</span> <span class="o">-</span> <span class="n">union</span><span class="p">)</span> <span class="o">/</span> <span class="n">c_area</span>  <span class="c1"># GIoU</span>
        <span class="k">if</span> <span class="n">DIoU</span> <span class="ow">or</span> <span class="n">CIoU</span><span class="p">:</span>  <span class="c1"># Distance or Complete IoU https://arxiv.org/abs/1911.08287v1</span>
            <span class="c1"># convex diagonal squared 计算对角线的平方</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">cw</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ch</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-16</span>
            <span class="c1"># centerpoint distance squared</span>
            <span class="c1"># 计算两个矩形中点的欧式距离</span>
            <span class="n">rho2</span> <span class="o">=</span> <span class="p">((</span><span class="n">b2_x1</span> <span class="o">+</span> <span class="n">b2_x2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">b1_x1</span> <span class="o">+</span> <span class="n">b1_x2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">((</span><span class="n">b2_y1</span> <span class="o">+</span> <span class="n">b2_y2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">b1_y1</span> <span class="o">+</span> <span class="n">b1_y2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="k">if</span> <span class="n">DIoU</span><span class="p">:</span>
                <span class="c1"># 返回DIoU值</span>
                <span class="k">return</span> <span class="n">iou</span> <span class="o">-</span> <span class="n">rho2</span> <span class="o">/</span> <span class="n">c2</span>  <span class="c1"># DIoU</span>
            <span class="k">elif</span> <span class="n">CIoU</span><span class="p">:</span>  <span class="c1"># https://github.com/Zzh-tju/DIoU-SSD-pytorch/blob/master/utils/box/box_utils.py#L47</span>
                <span class="c1"># 额外计算α和v两个变量</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">w2</span> <span class="o">/</span> <span class="n">h2</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">w1</span> <span class="o">/</span> <span class="n">h1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">iou</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">iou</span> <span class="o">-</span> <span class="p">(</span><span class="n">rho2</span> <span class="o">/</span> <span class="n">c2</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>  <span class="c1"># CIoU</span>

    <span class="k">return</span> <span class="n">iou</span>
</code></pre></div>
<blockquote>
<p>初步完稿于：2023年2月15日</p>
</blockquote>
<p>注：以上仅是笔者个人见解，若有问题，欢迎指正。</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.cd18aaf1.min.js"></script>
      
        <script src="../../../../mathjax-config.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
      
        <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      
    
  </body>
</html>